/* Generates a focused Essbase calculation script based on runtime prompts.
   Uses invokeMethod to bypass strict compiler checks and restricted imports.
*/

final String RTP_ENTITY     = "rtp_Entity"
final String RTP_COSTCENTRE = "rtp_CostCentre"
final String RTP_SCENARIO   = "rtp_Scenario"
final String RTP_VERSION    = "rtp_Version"
final String DIM_COSTCENTRE = "Cost Centre"

// Retrieve member names
String sEntity     = rtps.get(RTP_ENTITY).getMember().getName()
String sCostCentre = rtps.get(RTP_COSTCENTRE).getMember().getName()
String sScenario   = rtps.get(RTP_SCENARIO).getMember().getName()
String sVersion    = rtps.get(RTP_VERSION).getMember().getName()

// Construct the script string
String sCalcScript = """
    FIX("${sEntity}", "${sScenario}", "${sVersion}")
        AGG("${DIM_COSTCENTRE}");
    ENDFIX
""".toString()

println("Executing Dynamic Script for: " + sEntity)

// 1. Get the Cube (Cast to GroovyObject to access dynamic methods)
GroovyObject cube = (GroovyObject) operation.application.getCube("PBCS1")

// 2. Create Script using invokeMethod to bypass "Method not found" error
// Args must be passed as an array/list
GroovyObject script = (GroovyObject) cube.invokeMethod("createCalcScript", [sCalcScript] as Object[])

// 3. Execute the script object
script.invokeMethod("execute", [] as Object[])
